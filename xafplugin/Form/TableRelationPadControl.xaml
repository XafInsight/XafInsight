<Window x:Class="xafplugin.Form.TableRelationPadControl"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Export Definition" Height="600" Width="920"
        WindowStartupLocation="CenterScreen"
        Background="White"
        ResizeMode="NoResize">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*" />
            <!-- Important: star for main area! -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top: MainTable + RelationPad -->
        <StackPanel Orientation="Horizontal" Grid.Row="0" VerticalAlignment="Top" Margin="0,0,0,20">
            <TextBlock Text="Main table:" FontWeight="Bold" FontSize="15" Margin="0,0,8,0" VerticalAlignment="Center"/>
            <ComboBox Width="150" Margin="0,0,20,0"
                      ItemsSource="{Binding Tables}"
                      SelectedItem="{Binding SelectedMainTable, Mode=TwoWay}" />
        </StackPanel>

        <!-- Main area: choose relation + columns, fully in a grid! -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3.4*" />
                <ColumnDefinition Width="60"/>
                <ColumnDefinition Width="1.5*" />
                <ColumnDefinition Width="40"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*" />
                <!-- Ensures ListBoxes always have equal height! -->
            </Grid.RowDefinitions>

            <!-- Left side: Relation path and description -->
            <StackPanel Grid.Column="0" Grid.Row="0">
                <TextBlock Text="Choose relation from current path" FontWeight="Bold" Margin="0,0,0,8"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,18">
                    <ComboBox Width="170"
                              ItemsSource="{Binding AvailableRelations}"
                              SelectedItem="{Binding SelectedRelation, Mode=TwoWay}" />
                    <Button Content="Go to relation" Width="120" Margin="8,0,0,0" Click="BtnAddRelation_Click"/>
                    <Button Content="Step back" Width="100" Margin="8,0,0,0" Click="BtnBackRelation_Click" />
                    <Button Content="Manage relations" Width="130" Margin="8,0,0,0" Click="BtnRelatieToevoegen_Click"/>
                </StackPanel>
                <ItemsControl ItemsSource="{Binding RelationPath}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="→ " FontWeight="Bold" FontSize="15" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding}" FontWeight="Normal" FontSize="13" VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <TextBlock Text="Available columns from final table" FontWeight="Bold" Margin="0,0,0,8"/>
            </StackPanel>

            <!-- Available columns ListBox, directly in grid, no StackPanel! -->
            <ListBox Grid.Column="0" Grid.Row="1"
                     x:Name="ListAvailableColumns"
                     ItemsSource="{Binding AvailableColumns}"
                     DisplayMemberPath="Display"
                     SelectionMode="Extended"
                     VerticalAlignment="Stretch" />

            <!-- Middle: arrows -->
            <StackPanel Grid.Column="1" Grid.Row="1" VerticalAlignment="Center">
                <Button x:Name="BtnAddColumn" Width="38" Height="38" Margin="0,4" Content="→"
                        Click="BtnAddColumn_Click"/>
                <Button x:Name="BtnRemoveColumn" Width="38" Height="38" Margin="0,4" Content="←"
                        Click="BtnRemoveColumn_Click"/>
            </StackPanel>

            <!-- Selected columns ListBox with multi-select -->
            <ListBox Grid.Column="2" Grid.Row="1"
                     x:Name="ListSelectedColumns"
                     ItemsSource="{Binding SelectedColumns}"
                     DisplayMemberPath="Display"
                     SelectionMode="Extended"
                     VerticalAlignment="Stretch" />
                     
            <!-- Reordering buttons (up/down) -->
            <StackPanel Grid.Column="3" Grid.Row="1" VerticalAlignment="Center">
                <Button x:Name="BtnMoveUp" Width="30" Height="30" Margin="4" Content="↑"
                        Click="BtnMoveUp_Click" ToolTip="Move selected columns up"/>
                <Button x:Name="BtnMoveDown" Width="30" Height="30" Margin="4" Content="↓" 
                        Click="BtnMoveDown_Click" ToolTip="Move selected columns down"/>
                <Button x:Name="BtnAddCustomColumn" Width="30" Height="30" Margin="4" Content="+" 
                        FontSize="16" FontWeight="Bold"
                        Click="BtnAddCustomColumn_Click" ToolTip="Add custom column"/>
            </StackPanel>
        </Grid>

        <!-- Bottom button row -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,24,0,0">
            <Button Content="Save" Width="120" Height="28" Click="BtnOpslaan_Click" />
        </StackPanel>
    </Grid>
</Window>
